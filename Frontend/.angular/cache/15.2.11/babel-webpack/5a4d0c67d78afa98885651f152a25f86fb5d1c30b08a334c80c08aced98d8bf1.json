{"ast":null,"code":"import { BehaviorSubject, of } from 'rxjs';\nimport { map, finalize, switchMap, catchError } from 'rxjs/operators';\nimport { environment } from '../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"./account.service\";\nexport let EmployeeService = /*#__PURE__*/(() => {\n  class EmployeeService {\n    constructor(router, http, accountService) {\n      this.router = router;\n      this.http = http;\n      this.accountService = accountService;\n      this.employeeSubject = new BehaviorSubject(null);\n      this.employee = this.employeeSubject.asObservable();\n    }\n    get employeeValue() {\n      return this.employeeSubject.value;\n    }\n    getAll() {\n      return this.http.get(`${environment.apiUrl}/employees`).pipe(map(employees => {\n        return employees.map(employee => this.mapDepartmentName(employee));\n      }));\n    }\n    getById(id) {\n      return this.http.get(`${environment.apiUrl}/employees/${id}`).pipe(map(employee => this.mapDepartmentName(employee)));\n    }\n    getByAccountId(accountId) {\n      return this.http.get(`${environment.apiUrl}/employees/account/${accountId}`).pipe(map(employee => this.mapDepartmentName(employee)));\n    }\n    create(employee) {\n      return this.http.post(`${environment.apiUrl}/employees`, employee).pipe(map(employee => this.mapDepartmentName(employee)));\n    }\n    update(id, params) {\n      return this.http.put(`${environment.apiUrl}/employees/${id}`, params).pipe(map(employee => {\n        var _a;\n        // Map department name\n        employee = this.mapDepartmentName(employee);\n        // update employee if it's the current employee\n        if (employee.id === ((_a = this.employeeValue) === null || _a === void 0 ? void 0 : _a.id)) {\n          // publish updated employee to subscribers\n          employee = Object.assign(Object.assign({}, this.employeeValue), employee);\n          this.employeeSubject.next(employee);\n        }\n        return employee;\n      }));\n    }\n    delete(id) {\n      return this.http.delete(`${environment.apiUrl}/employees/${id}`).pipe(finalize(() => {\n        var _a;\n        // auto logout if the logged in employee was deleted\n        if (id === ((_a = this.employeeValue) === null || _a === void 0 ? void 0 : _a.id)) this.employeeSubject.next(null);\n      }));\n    }\n    mapDepartmentName(employee) {\n      if (employee && employee['Department']) {\n        return Object.assign(Object.assign({}, employee), {\n          departmentName: employee['Department'].name\n        });\n      }\n      return employee;\n    }\n    getCurrentEmployeeId() {\n      return this.accountService.account.pipe(switchMap(account => {\n        if (!account) {\n          return of(null);\n        }\n        return this.getByAccountId(account.id).pipe(map(employee => employee.id.toString()), catchError(() => of(null)));\n      }), catchError(() => of(null)));\n    }\n  }\n  EmployeeService.ɵfac = function EmployeeService_Factory(t) {\n    return new (t || EmployeeService)(i0.ɵɵinject(i1.Router), i0.ɵɵinject(i2.HttpClient), i0.ɵɵinject(i3.AccountService));\n  };\n  EmployeeService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: EmployeeService,\n    factory: EmployeeService.ɵfac,\n    providedIn: 'root'\n  });\n  return EmployeeService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}